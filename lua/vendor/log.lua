local a={name='vlog',clog=true,hls=true,ufle=true,lv="trace",mod={{name="trace",hl="Comment"},{name="info",hl="None"}},float=0.01}local b,c,d,e,f,g,h={},string.format,os.date,io.open,debug.getinfo,table.concat,vim.fn;local i,j,k,l,m=vim.cmd,vim.inspect,vim.tbl_deep_extend,h.stdpath,h.escape;local function n(o,p)return#o>p and"..."..o:sub(#o-p)or o end;b.new=function(q,r)q=k("force",a,q)local s,t=q.name,ipairs;local u=c('%s/%s.log',l('data'),s)local v=r and b or{}local w={}for x,p in t(q.mod)do w[p.name]=x;p.upper=p.name:upper()end;local function y(...)local z,A,B,C,D={},q.float,tostring,type,select;for x=1,D('#',...)do local E=D(x,...)E=C(E)=="number"and A and c("%."..toString(A):match("%d+").."f",E)or C(E)=="table"and j(E)or B(E)z[#z+1]=E end;return g(z," ")end;local function F(G,H,I,...)if G<w[q.lv]then return end;local J,K,L,M=f(3,"Sl"),H.upper,q.hls,H.hl;local N=n(J.short_src,25)..":"..J.currentline;local O,P=I(...),"[%-6s%s] %s: "local Q,R=d("%H:%M:%S"),d()local S,T=c(P,K,Q,N),c(P,K,R,N)local U={}for V in O:gmatch("([^\n]*)\n?")do if V~=""then U[#U+1]=V end end;if q.clog then if L and M then i(c("echohl %s",M))end;for W,V in t(U)do i(c([[echom "[%s] %s"]],s,m(S..V,'"')))end;if L and M then i("echohl NONE")end end;if q.ufle and#U>0 then local X=e(u,"a")if X then for W,V in t(U)do X:write(T..V.."\n")end;X:close()end end end;for x,p in t(q.mod)do v[p.name]=function(...)F(x,p,y,...)end;v["fmt_"..p.name]=function(...)F(x,p,function(Y,...)local Z={}for W,E in t({...})do Z[#Z+1]=j(E)end;return c(Y,unpack(Z))end,...)end end;return v end;b.new(a,true)return b

